import{C as e,I as t,M as n,N as r,P as i,T as a,_ as o,b as s,c,d as l,f as u,g as d,h as f,i as p,j as m,l as h,m as g,o as _,p as ee,r as te,s as v,u as y,v as b,w as x,x as S}from"./B_kjpjqf.js";var ne={class:`overflow-hidden`,id:`comments`},re={class:`py-4`},ie={class:`text-xl font-bold text-gray-800`},ae={class:`p-6 bg-gray-50 rounded-lg`},oe={class:`grid grid-cols-1 md:grid-cols-3 gap-4 mb-4`},se={class:`mb-4`},ce={class:`flex justify-end`},le=[`disabled`],ue={class:`divide-y divide-gray-100 mt-5`},de={key:0,class:`p-8 text-center text-gray-500`},fe={key:1,class:`p-8 text-center text-gray-500`},pe={key:2,class:`divide-y divide-gray-100`},me=[`id`],C={class:`flex items-start`},w={class:`shrink-0 mr-4`},T={class:`h-10 w-10 rounded-full bg-linear-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-bold`},E={class:`flex-1`},D={class:`flex items-center justify-between mb-1`},O={class:`text-sm font-medium text-gray-900`},k={class:`mt-2 flex space-x-4 text-xs`},A={class:`text-gray-500`},j=[`onClick`],M={class:`text-gray-700 whitespace-pre-line`},N={key:0,class:`mt-6 ml-12 border-l-2 border-gray-200 pl-6`},P=[`id`],F={class:`flex items-start`},I={class:`shrink-0 mr-4`},L={class:`h-9 w-9 rounded-full bg-linear-to-br from-green-400 to-teal-500 flex items-center justify-center text-white font-bold`},R={class:`flex-1`},z={class:`flex items-center justify-between mb-1`},he={class:`text-sm font-medium text-gray-900`},ge={class:`mt-2 flex space-x-4 text-xs`},_e={class:`text-gray-500`},ve=[`onClick`],ye={class:`text-gray-700 whitespace-pre-line`},B={__name:`comments`,props:{post:{type:Object,required:!0}},setup(p){let B=h(),V=y();c();let H=p,U=n([]),W=n(``),G=n(``),K=n(``),q=n(``),J=n(!1),Y=n(!1),X=n(0),Z=n(0),be=g(()=>Math.ceil(Z.value/12)),Q=n(parseInt(B.params.comment_page||`1`));async function $(){J.value=!0;try{let{data:e}=await v(`/nv/front-stage/get-comment-list`,{post:H.post.id,current_page:Q.value,comments_per_page:2});e&&e.data&&(U.value=_(e.data),Z.value=e.pagination.total)}catch(e){console.error(`获取评论失败:`,e)}finally{J.value=!1}}function xe(e){Q.value=e,V.push(`/${H.post.slug}/comment-page-${e}`)}async function Se(){if(W.value.trim()){Y.value=!0;try{let{data:e}=await v(`/nv/add-comment`,{content:W.value,post_id:H.post.id,email:G.value,url:K.value,name:q.value,parent:X.value||void 0});if(e.error){window.$message.error(e.error);return}e.public&&(X.value||(Q.value=1),$()),W.value=``,G.value=``,K.value=``,q.value=``}catch(e){console.error(`提交评论失败:`,e)}finally{Y.value=!1}}}return e(()=>{if($(),B.params.comment_page){let e=document.getElementById(`comments`);e&&setTimeout(()=>{e.scrollIntoView({behavior:`smooth`})},300)}}),(e,n)=>(x(),b(`section`,null,[f(`div`,ne,[f(`div`,re,[f(`h2`,ie,`评论列表 (`+t(U.value.length)+`)`,1)]),(x(),d(ee,{to:X.value?`#comment-item-${X.value}`:null,disabled:!X.value},[f(`div`,ae,[f(`div`,oe,[f(`div`,null,[m(f(`input`,{"onUpdate:modelValue":n[0]||=e=>q.value=e,type:`text`,class:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent`,placeholder:`你的名字`},null,512),[[l,q.value]])]),f(`div`,null,[m(f(`input`,{"onUpdate:modelValue":n[1]||=e=>G.value=e,type:`email`,class:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent`,placeholder:`电子邮箱`},null,512),[[l,G.value]])]),f(`div`,null,[m(f(`input`,{"onUpdate:modelValue":n[2]||=e=>K.value=e,type:`url`,class:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent`,placeholder:`个人网站`},null,512),[[l,K.value]])])]),f(`div`,se,[m(f(`textarea`,{"onUpdate:modelValue":n[3]||=e=>W.value=e,rows:`3`,class:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none`,placeholder:`分享你的想法...`},null,512),[[l,W.value]])]),f(`div`,ce,[f(`button`,{onClick:Se,disabled:Y.value||!W.value.trim(),class:i([`px-4 py-2 rounded-lg font-medium transition-colors duration-200`,Y.value||!W.value.trim()?`bg-gray-300 text-gray-500 cursor-not-allowed`:`bg-blue-500 text-white hover:bg-blue-600`])},t(Y.value?`发布中...`:`发布评论`),11,le),X.value?(x(),b(`button`,{key:0,class:`px-4 py-2 rounded-lg font-medium transition-colors duration-200 bg-gray-300 text-gray-500 hover:bg-gray-400 ml-2`,onClick:n[4]||=e=>X.value=null},`取消回复`)):o(``,!0)])])],8,[`to`,`disabled`])),f(`div`,ue,[J.value?(x(),b(`div`,de,[...n[5]||=[f(`svg`,{class:`animate-spin h-8 w-8 text-blue-500 mx-auto mb-2`,xmlns:`http://www.w3.org/2000/svg`,fill:`none`,viewBox:`0 0 24 24`},[f(`circle`,{class:`opacity-25`,cx:`12`,cy:`12`,r:`10`,stroke:`currentColor`,"stroke-width":`4`}),f(`path`,{class:`opacity-75`,fill:`currentColor`,d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z`})],-1),s(` 加载评论中... `,-1)]])):U.value.length?(x(),b(`ul`,pe,[(x(!0),b(u,null,a(U.value,e=>(x(),b(`li`,{id:`comment-item-${e.id}`,key:e.id,class:`p-6`},[f(`div`,C,[f(`div`,w,[f(`div`,T,t(e.name?e.name.charAt(0).toUpperCase():`U`),1)]),f(`div`,E,[f(`div`,D,[f(`h3`,O,t(e.name),1),f(`div`,k,[f(`span`,A,t(new Date(e.date).toLocaleString()),1),f(`button`,{onClick:t=>X.value=e.id,class:`text-gray-500 cursor-pointer hover:text-blue-500 transition-colors flex items-center`},` 回复 `,8,j)])]),f(`p`,M,t(e.content),1)])]),e.children&&e.children.length?(x(),b(`ul`,N,[(x(!0),b(u,null,a(e.children,e=>(x(),b(`li`,{key:e.id,class:`mb-6`,id:`comment-item-${e.id}`},[f(`div`,F,[f(`div`,I,[f(`div`,L,t(e.name?e.name.charAt(0).toUpperCase():`U`),1)]),f(`div`,R,[f(`div`,z,[f(`h3`,he,t(e.name),1),f(`div`,ge,[f(`span`,_e,t(new Date(e.date).toLocaleString()),1),f(`button`,{onClick:t=>X.value=e.id,class:`text-gray-500 cursor-pointer hover:text-blue-500 transition-colors flex items-center`},` 回复 `,8,ve)])]),f(`p`,ye,t(e.content),1)])])],8,P))),128))])):o(``,!0)],8,me))),128))])):(x(),b(`div`,fe,[...n[6]||=[f(`p`,null,`暂无评论，快来发表第一条评论吧！`,-1)]]))])]),S(r(te),{"current-page":Q.value,"total-pages":be.value,onPageChange:xe},null,8,[`current-page`,`total-pages`])]))}},V={class:`container mx-auto px-4 py-8`},H=[`src`],U={key:1,class:`text-center text-gray-500 h-64 bg-gray-100 rounded-lg leading-64 mb-8`},W={class:`text-4xl font-bold mb-4`},G={class:`text-gray-500 mb-8`},K={class:`prose max-w-none`},q={__name:`index`,setup(e){let i=c(),a=y(),l=n({metas:{},content:{blocks:[]},taxonomies:{category:[],tag:[]}});async function u(){let{data:e}=await v(`/nv/front-stage/get-post`,{slug:encodeURIComponent(decodeURIComponent(i.post_slug))});if(e.error){a.replace({name:`nothing-is-here`});return}l.value=e}u();let m=g(()=>(l.value.taxonomies.category||[]).map(e=>e.name).join(`, `)),h=g(()=>(l.value.taxonomies.tag||[]).map(e=>e.name).join(`, `));return(e,n)=>(x(),b(`div`,V,[l.value.metas._nv_thumbnail?(x(),b(`img`,{key:0,src:l.value.metas._nv_thumbnail,alt:`封面图`,class:`rounded-lg w-full h-64 object-cover mb-8`},null,8,H)):(x(),b(`div`,U,`暂无封面图`)),f(`h1`,W,t(l.value.title),1),f(`div`,G,[f(`span`,null,`作者: `+t(l.value.author_name),1),n[0]||=s(` | `,-1),f(`span`,null,`发布日期: `+t(new Date(l.value.modified_time).toLocaleString()),1),n[1]||=s(` | `,-1),f(`span`,null,`分类: `+t(m.value),1),n[2]||=s(` | `,-1),f(`span`,null,`标签: `+t(h.value),1)]),f(`main`,K,[S(r(p),{is:`article`,blocks:l.value.content.blocks,ref:`article`},null,8,[`blocks`]),l.value.id?(x(),d(B,{key:0,post:l.value},null,8,[`post`])):o(``,!0)])]))}};export{q as default};